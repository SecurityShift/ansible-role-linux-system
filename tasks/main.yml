---
# tasks file for common

- import_role:
    name: ansible
  tags:
    - ansible

- import_role:
    name: spacewalk-client
  tags:
    - spacewalk

- import_role:
    name: ovirt-virtual-machine
    tasks_from: guestagent.yml
  when: ansible_system_vendor == 'oVirt'
  tags:
    - ovirt

- import_role:
    name: icinga-agent
    tasks_from: nrpe.yml
  tags:
    - monitoring

- import_role:
    name: freeipa-client
  tags:
    - freeipa-client

- import_role:
    name: certmonger
  tags:
    - certmonger

- import_role:
   name: ssh
  tags:
    - ssh

- import_role:
    name: selinux
  tags:
    - selinux

- import_role:
    name: firewalld
  tags:
    - firewall

- import_role:
    name: postfix
  tags:
    - mail

- import_role:
    name: ossec-agent
  when: ossec_host_group not in group_names
  tags:
    - ossec

- import_role:
    name: chrony
  when: "'ipaservers' not in group_names"
  tags:
    - ntp

# FreeIPA doesnt yet support chrony on server
- import_role:
    name: ntp
  when: "'ipaservers' in group_names"
  tags:
    - ntp

- import_role:
    name: logrotate
  tags:
    - logrotate

- import_role:
    name: dell-system-updates
  when: ansible_system_vendor == "Dell Inc."
  tags:
    - dell
- name: Use FQDN in shell prompt
  copy:
    content: 'PS1="[\u@\H \W]\\$ "'
    dest: /etc/profile.d/prompt.sh
    owner: root
    group: root
    mode: 0644
  tags:
    - shell
    - prompt

- name: Add motd, for post authentication
  template:
    src: motd.j2
    dest: /etc/motd
  tags:
    - shell
    - motd

- name: Add issue, for pre authentication
  template:
    src: issue.j2
    dest: /etc/{{ item }}
  with_items:
    - issue
    - issue.net
  tags:
    - issue
    - shell

- name: Setup Logical Volume Manager
  import_tasks: lvm.yml
  tags:
    - lvm
    - storage

- name: Setup Filesystems
  import_tasks: fs.yml
  tags:
    - fs
    - storage

- name: Configure filesystem mounts
  import_tasks: mount.yml
  tags:
    - mount
    - storage

- name: Install useful packages
  yum:
    name: '{{ item }}'
    state: installed
  with_items:
    - vim-enhanced

